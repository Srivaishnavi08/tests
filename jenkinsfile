pipeline {
    agent any
    stages {
        stage('Build Docker Image for HTML Server') {
            steps {
                script {
                    // Build the Docker image for the HTTP server
                    bat 'docker build -t my-python-server .'
                }
            }
        }
        stage('Run HTML Server') {
            steps {
                script {
                    // Run the container to serve the HTML file
                    bat 'docker run -d -p 8000:8000 --name html-server my-python-server'
                }
            }
        }
        stage('Pull Docker Image for Selenium') {
            steps {
                script {
                    bat 'docker pull selenium/standalone-chrome'
                }
            }
        }
        stage('Start Selenium Container') {
            steps {
                script {
                    // Run the Selenium container
                    bat 'docker run -d -p 4444:4444 --name selenium-chrome selenium/standalone-chrome'
                }
            }
        }
        stage('Run Tests') {
            steps {
                script {
                    // Run your test file in a new terminal window
                    bat 'start cmd'
                    bat 'python seleniumDockerTest.py'
                }
            }
        }
        stage('Clean Up') {
            steps {
                script {
                    // Stop and remove the Selenium container
                    bat 'docker stop selenium-chrome'
                    bat 'docker rm selenium-chrome'
                    // Stop and remove the HTML server container
                    bat 'docker stop html-server'
                    bat 'docker rm html-server'
                }
            }
        }
    }
}
